<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centerville FD Training Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            color: #000;
            line-height: 1.6;
            font-size: 16px;
        }
        .container {
            max-width: 1000px;
            margin: 40px auto;
            background: white;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
            text-align: center;
        }
        header img {
            width: 140px;
            height: auto;
            margin-bottom: 20px;
        }
        .header-text h1 {
            font-size: 2.8rem;
            color: #000;
            margin-bottom: 8px;
        }
        .header-text p {
            font-size: 1.4rem;
            color: #d32f2f;
        }
        .section {
            margin-bottom: 50px;
        }
        .section h2 {
            font-size: 1.5rem;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        #training-details .form-group {
            margin-bottom: 15px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        .time-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .time-input {
            width: 70px;
            text-align: center;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
        }
        .colon {
            font-size: 1.4rem;
            font-weight: bold;
            margin: 0 5px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        #description, #objectives {
            color: #0000ff !important;
        }
        .copy-wrapper {
            display: flex;
            justify-content: flex-end;
            margin-top: 8px;
        }
        .copy-btn {
            padding: 8px 16px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .copy-btn:hover {
            background: #1d4ed8;
        }
        .copy-feedback {
            margin-left: 10px;
            padding: 8px 16px;
            background: #16a34a;
            color: white;
            border-radius: 6px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .table th, .table td {
            padding: 12px;
            border: 1px solid #ccc;
            text-align: left;
            vertical-align: top;
        }
        .table th {
            background: #f1f5f9;
            font-weight: 600;
        }
        #instructors-table td, #students-centerville-table td {
            font-size: 0.85rem;
        }
        /* Column widths */
        #instructors-table th:nth-child(1), #instructors-table td:nth-child(1),
        #students-centerville-table th:nth-child(1), #students-centerville-table td:nth-child(1),
        #students-outside-table th:nth-child(1), #students-outside-table td:nth-child(1) { width: 300px; }
        #instructors-table th:nth-child(2), #instructors-table td:nth-child(2),
        #students-centerville-table th:nth-child(2), #students-centerville-table td:nth-child(2) { width: 200px; }
        #instructors-table th:nth-child(3), #instructors-table td:nth-child(3),
        #students-centerville-table th:nth-child(3), #students-centerville-table td:nth-child(3) { width: 160px; }
        #instructors-table th:nth-child(4), #instructors-table td:nth-child(4),
        #students-centerville-table th:nth-child(4), #students-centerville-table td:nth-child(4),
        #students-outside-table th:nth-child(4), #students-outside-table td:nth-child(4) { width: 340px; }
        #students-outside-table th:nth-child(2), #students-outside-table td:nth-child(2),
        #students-outside-table th:nth-child(3), #students-outside-table td:nth-child(3) { width: 180px; }
        /* Grading Points & Equipment tables */
        #grading-points-table th:nth-child(1), #grading-points-table td:nth-child(1),
        #facility-equipment-table th:nth-child(1), #facility-equipment-table td:nth-child(1) { width: 380px; }
        #grading-points-table th:nth-child(2), #grading-points-table td:nth-child(2),
        #facility-equipment-table th:nth-child(2), #facility-equipment-table td:nth-child(2) { width: 180px; }
        #grading-points-table th:nth-child(3), #grading-points-table td:nth-child(3),
        #facility-equipment-table th:nth-child(3), #facility-equipment-table td:nth-child(3) { width: 440px; }
        #drivers-training-section .drivers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        #drivers-training-section .form-group {
            margin-bottom: 0;
        }
        #drivers-training-section select {
            width: 100%;
            min-width: 220px;
        }
        .miles-line {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        /* Shifts under Date, Total Hours centered between Start/End Time */
        .shift-under-date {
            margin-top: 20px;
        }
        .time-and-total {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .time-row {
            display: flex;
            gap: 40px;
            justify-content: center;
            margin-bottom: 15px;
        }
        .total-hours-in-between {
            width: 180px;
            text-align: center;
        }
        .shift-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }
        .shift-btn {
            padding: 10px 16px;
            border: 2px solid #000;
            border-radius: 8px;
            background: white;
            color: #000;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 80px;
            text-align: center;
        }
        .shift-btn:hover {
            opacity: 0.8;
        }
        .shift-btn.selected {
            color: white;
        }
        #shift-days.selected { background: #fbbf24; border-color: #fbbf24; }
        #shift-1.selected { background: #16a34a; border-color: #16a34a; }
        #shift-2.selected { background: #2563eb; border-color: #2563eb; }
        #shift-3.selected { background: #dc2626; border-color: #dc2626; }
        #shift-pt.selected { background: #f97316; border-color: #f97316; }
        .damaged-buttons {
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }
        .damaged-btn {
            padding: 10px 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 80px;
            text-align: center;
            background: white;
            color: #000;
            transition: all 0.2s;
        }
        .damaged-yes.selected {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }
        .damaged-no.selected {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        .damaged-btn:hover {
            opacity: 0.9;
        }
        .remove-btn, .remove-grading-btn, .remove-equipment-btn {
            display: block;
            margin-top: 10px;
            padding: 6px 12px;
            font-size: 0.85rem;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        .remove-btn:hover, .remove-grading-btn:hover, .remove-equipment-btn:hover {
            background: #b91c1c;
        }
        .signature-display {
            border: 1px solid #ccc;
            border-radius: 8px;
            background: #fff;
            width: 100%;
            height: 120px;
            object-fit: contain;
        }
        .sign-btn {
            padding: 8px 16px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .sign-btn:hover {
            background: #1d4ed8;
        }
        #other-personnel-toggle {
            padding: 12px 24px;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 15px;
            display: block;
        }
        #other-personnel-toggle:hover {
            background: #b91c1c;
        }
        #other-personnel-toggle.active {
            background: #16a34a;
        }
        #other-personnel-toggle.active:hover {
            background: #15803d;
        }
        #other-personnel {
            display: none;
        }
        .signature-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            max-width: 90%;
            max-height: 90%;
        }
        .modal-canvas {
            border: 2px solid #ccc;
            background: #fff;
            cursor: crosshair;
            touch-action: none;
        }
        .modal-buttons {
            margin-top: 15px;
        }
        .modal-buttons button {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }
        .clear-btn {
            background: #dc2626;
            color: white;
        }
        .clear-btn:hover {
            background: #b91c1c;
        }
        .done-btn {
            background: #2563eb;
            color: white;
        }
        .done-btn:hover {
            background: #1d4ed8;
        }
        .buttons-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0 20px;
        }
        .submit-btn, .print-btn {
            padding: 18px 30px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            font-size: 1.4rem;
        }
        .print-btn {
            background: #16a34a;
        }
        .print-btn:hover {
            background: #15803d;
        }
        .city-logo {
            width: 300px;
            height: auto;
            margin: 40px auto;
            display: block;
        }
        /* Add buttons styled like copy buttons */
        #add-instructor, #add-student-centerville, #add-student-outside, #add-grading-point, #add-equipment {
            padding: 8px 16px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            display: block;
        }
        #add-instructor:hover, #add-student-centerville:hover, #add-student-outside:hover, #add-grading-point:hover, #add-equipment:hover {
            background: #1d4ed8;
        }
        @media (max-width: 768px) {
            .container { padding: 20px; }
            header img { width: 120px; }
            h1 { font-size: 2.2rem; }
            .city-logo { width: 250px; }
            .buttons-row { flex-direction: column; }
            .submit-btn, .print-btn { width: 100%; margin: 10px 0; }
            .form-row { grid-template-columns: 1fr; }
            .table th, .table td { font-size: 0.8rem; padding: 8px; }
            .shift-group { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="patch.png" alt="Centerville FD Patch">
            <div class="header-text">
                <h1>Centerville Fire Department</h1>
                <p>Training Report</p>
            </div>
        </header>
        <form id="trainingForm">
            <div class="section" id="training-details">
                <h2>Training Details</h2>
                <div class="form-group">
                    <label for="training-title">Training Course Title:</label>
                    <input type="text" id="training-title" name="training-title" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="date">Date:</label>
                        <input type="date" id="date" name="date" required>
                        <div class="shift-under-date">
                            <label>Shift (select all that apply):</label>
                            <div class="shift-group">
                                <button type="button" class="shift-btn" id="shift-days" onclick="toggleShift('shift-days')">Days</button>
                                <button type="button" class="shift-btn" id="shift-1" onclick="toggleShift('shift-1')">Shift 1</button>
                                <button type="button" class="shift-btn" id="shift-2" onclick="toggleShift('shift-2')">Shift 2</button>
                                <button type="button" class="shift-btn" id="shift-3" onclick="toggleShift('shift-3')">Shift 3</button>
                                <button type="button" class="shift-btn" id="shift-pt" onclick="toggleShift('shift-pt')">PT</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="time-and-total">
                            <div class="time-row">
                                <div>
                                    <label>Start Time (24-hour):</label>
                                    <div class="time-group">
                                        <input type="text" id="start-hour" maxlength="2" placeholder="HH" class="time-input" required>
                                        <span class="colon">:</span>
                                        <input type="text" id="start-minute" maxlength="2" placeholder="MM" class="time-input" required>
                                    </div>
                                </div>
                                <div>
                                    <label>End Time (24-hour):</label>
                                    <div class="time-group">
                                        <input type="text" id="end-hour" maxlength="2" placeholder="HH" class="time-input" required>
                                        <span class="colon">:</span>
                                        <input type="text" id="end-minute" maxlength="2" placeholder="MM" class="time-input" required>
                                    </div>
                                </div>
                            </div>
                            <div class="total-hours-in-between">
                                <label for="total-hours">Total Hours:</label>
                                <input type="number" id="total-hours" name="total-hours" step="0.5">
                            </div>
                        </div>
                    </div>
                </div>
                <input type="hidden" id="selected-shifts" name="selected-shifts">
                <div class="form-group">
                    <label for="location">Location:</label>
                    <input type="text" id="location" name="location" required>
                </div>
                <div class="form-group">
                    <label for="iso-category">ISO Category:</label>
                    <select id="iso-category" name="iso-category" required>
                        <option value="">-- Select ISO Category --</option>
                        <option value="Company">Company</option>
                        <option value="Facility">Facility</option>
                        <option value="Officer">Officer</option>
                        <option value="Hazmat">Hazmat</option>
                        <option value="Driver (Roadway)">Driver (Roadway)</option>
                        <option value="Driver (Area Familiarization)">Driver (Area Familiarization)</option>
                        <option value="Driver (Pumper Training)">Driver (Pumper Training)</option>
                        <option value="Driver (Aerial Training)">Driver (Aerial Training)</option>
                        <option value="Recruit">Recruit</option>
                        <option value="EMS">EMS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="description">Description of Training:</label>
                    <textarea id="description" name="description" required></textarea>
                    <div class="copy-wrapper">
                        <button type="button" class="copy-btn" onclick="copyTextarea('description')">Copy Description</button>
                        <span class="copy-feedback" id="description-feedback">Copied!</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="objectives">Training Objectives:</label>
                    <textarea id="objectives" name="objectives" required></textarea>
                    <div class="copy-wrapper">
                        <button type="button" class="copy-btn" onclick="copyTextarea('objectives')">Copy Objectives</button>
                        <span class="copy-feedback" id="objectives-feedback">Copied!</span>
                    </div>
                </div>
            </div>
            <div class="section">
                <h2>Instructors</h2>
                <table class="table" id="instructors-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>GFSTC #</th>
                            <th>Signature</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button type="button" id="add-instructor">Add Instructor</button>
            </div>
            <div class="section">
                <h2>Students (Centerville)</h2>
                <table class="table" id="students-centerville-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>GFSTC #</th>
                            <th>Signature</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button type="button" id="add-student-centerville">Add Student</button>
                <button type="button" id="other-personnel-toggle">Other Personnel</button>
                <input type="checkbox" id="other-personnel" hidden>
            </div>
            <div class="section" id="outside-students-section">
                <h2>Students (Outside Dept.)</h2>
                <table class="table" id="students-outside-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Rank</th>
                            <th>GFSTC #</th>
                            <th>Signature</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button type="button" id="add-student-outside">Add Student</button>
            </div>
            <div class="section" id="drivers-training-section">
                <h2>Drivers Training Report</h2>
                <div class="drivers-grid">
                    <div class="form-group">
                        <label for="apparatus-type">Apparatus Type:</label>
                        <select id="apparatus-type" name="apparatus-type">
                            <option value="">-- Select --</option>
                            <option value="Rescue">Rescue</option>
                            <option value="Pumper">Pumper</option>
                            <option value="Aerial">Aerial</option>
                            <option value="Brush">Brush</option>
                            <option value="Command Car">Command Car</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="road-conditions">Road Conditions:</label>
                        <select id="road-conditions" name="road-conditions">
                            <option value="">-- Select --</option>
                            <option value="Dry">Dry</option>
                            <option value="Wet">Wet</option>
                            <option value="Icey">Icey</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="weather-conditions">Weather Conditions:</label>
                        <select id="weather-conditions" name="weather-conditions">
                            <option value="">-- Select --</option>
                            <option value="Clear">Clear</option>
                            <option value="Cloudy">Cloudy</option>
                            <option value="Mist">Mist</option>
                            <option value="Rain">Rain</option>
                            <option value="Thunderstorm">Thunderstorm</option>
                            <option value="Foggy">Foggy</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="traffic-conditions">Traffic Conditions:</label>
                        <select id="traffic-conditions" name="traffic-conditions">
                            <option value="">-- Select --</option>
                            <option value="Light">Light</option>
                            <option value="Moderate">Moderate</option>
                            <option value="Heavy">Heavy</option>
                        </select>
                    </div>
                </div>
                <div class="miles-line">
                    <div class="form-group">
                        <label for="apparatus-miles">Apparatus Miles:</label>
                        <input type="number" id="apparatus-miles" name="apparatus-miles">
                    </div>
                    <div class="form-group">
                        <label for="apparatus-hours">Apparatus Hours:</label>
                        <input type="number" id="apparatus-hours" name="apparatus-hours" step="0.5">
                    </div>
                    <div class="form-group">
                        <label for="actual-miles">Actual Miles Driven:</label>
                        <input type="number" id="actual-miles" name="actual-miles">
                    </div>
                </div>
                <table class="table" id="grading-points-table">
                    <thead>
                        <tr>
                            <th>Grading Points</th>
                            <th>Proficiency</th>
                            <th>Comments</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button type="button" id="add-grading-point">Add Grading Point</button>
            </div>
            <div class="section">
                <h2>Facility Equipment Used</h2>
                <table class="table" id="facility-equipment-table">
                    <thead>
                        <tr>
                            <th>Equipment Used</th>
                            <th>Damaged</th>
                            <th>Equipment Use Comments</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button type="button" id="add-equipment">Add Equipment</button>
            </div>
            <div class="buttons-row">
                <button type="submit" class="submit-btn">Submit Training Report</button>
                <button type="button" class="print-btn" onclick="window.print()">Print / Save as PDF</button>
            </div>
        </form>
        <img src="city-logo.png" alt="City of Centerville Logo" class="city-logo">
    </div>
    <!-- Signature Modal -->
    <div id="signatureModal" class="signature-modal">
        <div class="modal-content">
            <h3>Sign Here</h3>
            <canvas id="modalCanvas" class="modal-canvas" width="700" height="300"></canvas>
            <div class="modal-buttons">
                <button class="clear-signature-btn" id="clearSignature">Clear</button>
                <button class="done-btn" id="doneSignature">Done</button>
            </div>
        </div>
    </div>
    <script>
        // EmailJS init
        (function() {
            emailjs.init("0149jkoCQjJZn6JwD");
        })();

        // Auto-tab after 2 characters in time fields
        document.getElementById('start-hour').addEventListener('input', function(e) {
            if (this.value.length === 2) {
                document.getElementById('start-minute').focus();
            }
        });
        document.getElementById('start-minute').addEventListener('input', function(e) {
            if (this.value.length === 2) {
                document.getElementById('end-hour').focus();
            }
        });
        document.getElementById('end-hour').addEventListener('input', function(e) {
            if (this.value.length === 2) {
                document.getElementById('end-minute').focus();
            }
        });
        // Auto-calculate Total Hours from Start and End Time
        function calculateTotalHours() {
            const startH = parseInt(document.getElementById('start-hour').value) || 0;
            const startM = parseInt(document.getElementById('start-minute').value) || 0;
            const endH = parseInt(document.getElementById('end-hour').value) || 0;
            const endM = parseInt(document.getElementById('end-minute').value) || 0;
            if (document.getElementById('start-hour').value && document.getElementById('start-minute').value &&
                document.getElementById('end-hour').value && document.getElementById('end-minute').value) {
                let hours = endH - startH;
                let minutes = endM - startM;
                if (minutes < 0) {
                    minutes += 60;
                    hours--;
                }
                if (hours < 0) {
                    hours += 24;
                }
                const total = hours + minutes / 60;
                document.getElementById('total-hours').value = total.toFixed(2);
            } else {
                document.getElementById('total-hours').value = '';
            }
        }
        document.getElementById('start-hour').addEventListener('input', calculateTotalHours);
        document.getElementById('start-minute').addEventListener('input', calculateTotalHours);
        document.getElementById('end-hour').addEventListener('input', calculateTotalHours);
        document.getElementById('end-minute').addEventListener('input', calculateTotalHours);
        // Multi-select shift buttons
        function toggleShift(id) {
            const btn = document.getElementById(id);
            btn.classList.toggle('selected');
            updateSelectedShifts();
        }
        function updateSelectedShifts() {
            const selected = [];
            const buttons = ['shift-days', 'shift-1', 'shift-2', 'shift-3', 'shift-pt'];
            buttons.forEach(id => {
                if (document.getElementById(id).classList.contains('selected')) {
                    selected.push(document.getElementById(id).textContent.trim());
                }
            });
            document.getElementById('selected-shifts').value = selected.join(', ');
        }
        let currentSignatureCell = null;
        let modalCanvas = null;
        let modalCtx = null;
        const modal = document.getElementById('signatureModal');
        const clearBtn = document.getElementById('clearSignature');
        const doneBtn = document.getElementById('doneSignature');
        clearBtn.onclick = () => {
            modalCtx.clearRect(0, 0, modalCanvas.width, modalCanvas.height);
        };
        doneBtn.onclick = () => {
            if (currentSignatureCell) {
                const displayImg = currentSignatureCell.querySelector('.signature-display') || document.createElement('img');
                displayImg.className = 'signature-display';
                displayImg.src = modalCanvas.toDataURL();
                currentSignatureCell.innerHTML = '';
                currentSignatureCell.appendChild(displayImg);
                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = 'Remove';
                removeBtn.onclick = () => currentSignatureCell.closest('tr').remove();
                currentSignatureCell.appendChild(removeBtn);
            }
            modal.style.display = 'none';
        };
        function copyTextarea(id) {
            const textarea = document.getElementById(id);
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(textarea.value);
            const feedback = document.getElementById(id + '-feedback');
            feedback.style.opacity = 1;
            setTimeout(() => {
                feedback.style.opacity = 0;
            }, 1500);
        }
        const otherPersonnelToggle = document.getElementById('other-personnel-toggle');
        const otherPersonnelCheckbox = document.getElementById('other-personnel');
        const outsideSection = document.getElementById('outside-students-section');
        outsideSection.style.display = 'none';
        otherPersonnelToggle.addEventListener('click', () => {
            otherPersonnelCheckbox.checked = !otherPersonnelCheckbox.checked;
            if (otherPersonnelCheckbox.checked) {
                outsideSection.style.display = 'block';
                otherPersonnelToggle.classList.add('active');
            } else {
                outsideSection.style.display = 'none';
                otherPersonnelToggle.classList.remove('active');
            }
        });
        // ISO Category auto-fill for Driver (Roadway) and Driver (Area Familiarization)
        const isoCategory = document.getElementById('iso-category');
        const driversSection = document.getElementById('drivers-training-section');
        const descriptionTextarea = document.getElementById('description');
        const objectivesTextarea = document.getElementById('objectives');
        const driverDescription = "Firefighter driver training is a comprehensive program designed to equip emergency personnel with the knowledge, skills, and judgment to operate large, heavy fire apparatus safely and efficiently in emergency and non-emergency situations. This training emphasizes safety through accident avoidance and adherence to legal requirements.";
        const roadwayObjectives = `- Maneuvering large vehicles, including backing up and parallel parking with limited visibility\n- Negotiating narrow streets, sharp turns, and intersections safely\n- Defensive driving techniques and collision avoidance\n- Operating the vehicle under various weather and road conditions`;
        const areaFamiliarizationDescription = "Area familiarization training for firefighters is a continuous and proactive process designed to ensure that crews possess intimate knowledge of their first-due response area and the specific structures within it. This knowledge enhances situational awareness, improves response times, and is critical for both public and firefighter safety during emergencies.";
        const areaFamiliarizationObjectives = `- Ensuring knowledge of street locations and optimal response routes\n- Locating water sources\n- Identifying target hazards\n- Understanding building construction types\n- Familiarization with a building's fire suppression and alarm system\n- Locating critical access points`;
        const hideDriverReportCategories = ['Company', 'Facility', 'Officer', 'Hazmat', 'Recruit', 'EMS', 'Driver (Area Familiarization)'];
        isoCategory.addEventListener('change', () => {
            const selected = isoCategory.value;
            if (hideDriverReportCategories.includes(selected)) {
                driversSection.style.display = 'none';
            } else {
                driversSection.style.display = 'block';
            }
            if (selected === 'Driver (Roadway)') {
                descriptionTextarea.value = driverDescription;
                objectivesTextarea.value = roadwayObjectives;
            } else if (selected === 'Driver (Area Familiarization)') {
                descriptionTextarea.value = areaFamiliarizationDescription;
                objectivesTextarea.value = areaFamiliarizationObjectives;
            } else {
                descriptionTextarea.value = '';
                objectivesTextarea.value = '';
            }
        });
        // Initial check
        if (hideDriverReportCategories.includes(isoCategory.value)) {
            driversSection.style.display = 'none';
        } else {
            driversSection.style.display = 'block';
        }
        // Add Instructor
        document.getElementById('add-instructor').addEventListener('click', () => {
            const tbody = document.getElementById('instructors-table').querySelector('tbody');
            const row = tbody.insertRow();
            row.insertCell().innerHTML = `
                <select name="instructor-name">
                    <option value="">-- Select Instructor --</option>
                    <option value="Jones, Jason">Jones, Jason</option>
                    <option value="Bostick, David">Bostick, David</option>
                    <option value="Kahley, Chad">Kahley, Chad</option>
                    <option value="Dorman, David">Dorman, David</option>
                    <option value="Talley, Dustin">Talley, Dustin</option>
                    <option value="Redd, Allen">Redd, Allen</option>
                    <option value="Traxler, Clint">Traxler, Clint</option>
                </select>
            `;
            row.insertCell().innerHTML = `
                <select name="instructor-rank">
                    <option value="">-- Select Rank --</option>
                    <option value="Fire Chief">Fire Chief</option>
                    <option value="Assistant Chief">Assistant Chief</option>
                    <option value="Captain">Captain</option>
                    <option value="Sergeant">Sergeant</option>
                    <option value="Engineer">Engineer</option>
                    <option value="Firefighter">Firefighter</option>
                </select>
            `;
            row.insertCell().innerHTML = `
                <select name="instructor-gfstc">
                    <option value="">-- Select GFSTC # --</option>
                    <option value="4472-9279">4472-9279</option>
                    <option value="7615-2424">7615-2424</option>
                    <option value="5486-6025">5486-6025</option>
                    <option value="3081-2978">3081-2978</option>
                    <option value="3887-0449">3887-0449</option>
                    <option value="7135-8934">7135-8934</option>
                    <option value="3623-4177">3623-4177</option>
                </select>
            `;
            const signatureCell = row.insertCell();
            signatureCell.innerHTML = `<button type="button" class="sign-btn">Sign</button>`;
            signatureCell.querySelector('.sign-btn').addEventListener('click', () => {
                currentSignatureCell = signatureCell;
                modalCanvas = document.getElementById('modalCanvas');
                modalCtx = modalCanvas.getContext('2d');
                modalCtx.strokeStyle = '#0000ff';
                modalCtx.lineWidth = 3;
                modalCtx.lineCap = 'round';
                modalCtx.clearRect(0, 0, modalCanvas.width, modalCanvas.height);
                modal.style.display = 'flex';
            });
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = 'Remove';
            removeBtn.onclick = () => row.remove();
            signatureCell.appendChild(removeBtn);
        });
        // Add Student (Centerville)
        document.getElementById('add-student-centerville').addEventListener('click', () => {
            const tbody = document.getElementById('students-centerville-table').querySelector('tbody');
            const row = tbody.insertRow();
            row.insertCell().innerHTML = `
                <select name="student-centerville-name">
                    <option value="">-- Select Student --</option>
                    <option value="Barr, Harvey">Barr, Harvey</option>
                    <option value="Bennett,Kyle">Bennett, Kyle</option>
                    <option value="Bostick, David">Bostick, David</option>
                    <option value="Cannon, James">Cannon, James</option>
                    <option value="Carroll. James">Carroll, James</option>
                    <option value="Dorman, David">Dorman, David</option>
                    <option value="Dunn, Pierson">Dunn, Pierson</option>
                    <option value="Jones, Jason">Jones, Jason</option>
                    <option value="Kahley, Chad">Kahley, Chad</option>
                    <option value="Laimana, Joe">Laimana, Joe</option>
                    <option value="Leatherwood, Jonathan">Leatherwood, Jonathan</option>
                    <option value="Lightning, Larry">Lightning, Larry</option>
                    <option value="McNeil, Drew">McNeil, Drew</option>
                    <option value="Mixon, Joshua">Mixon, Joshua</option>
                    <option value="Mooney, William">Mooney, William</option>
                    <option value="Orona, Adam">Orona, Adam</option>
                    <option value="Redd, Allen">Redd, Allen</option>
                    <option value="Rice, Aaron">Rice, Aaron</option>
                    <option value="Schuler, Andrew">Schuler, Andrew</option>
                    <option value="Smith, Mikayla">Smith, Mikayla</option>
                    <option value="Stockholm, Jacob">Stockholm, Jacob</option>
                    <option value="Talley, Dustin">Talley, Dustin</option>
                    <option value="Thornton, Ethan">Thornton, Ethan</option>
                    <option value="Traxler, Clint">Traxler, Clint</option>
                    <option value="Wall, Kaleb">Wall, Kaleb</option>
                </select>
            `;
            row.insertCell().innerHTML = `
                <select name="student-centerville-rank">
                    <option value="">-- Select Rank --</option>
                    <option value="Fire Chief">Fire Chief</option>
                    <option value="Assistant Chief">Assistant Chief</option>
                    <option value="Captain">Captain</option>
                    <option value="Sergeant">Sergeant</option>
                    <option value="Engineer">Engineer</option>
                    <option value="Firefighter">Firefighter</option>
                </select>
            `;
            row.insertCell().innerHTML = `
                <select name="student-centerville-gfstc">
                    <option value="">-- Select GFSTC # --</option>
                    <option value="3353-4774">3353-4774</option>
                    <option value="0869-5796">0869-5796</option>
                    <option value="7615-2424">7615-2424</option>
                    <option value="7905-1906">7905-1906</option>
                    <option value="7560-2340">7560-2340</option>
                    <option value="3081-2978">3081-2978</option>
                    <option value="6345-7684">6345-7684</option>
                    <option value="4472-9279">4472-9279</option>
                    <option value="5486-6025">5486-6025</option>
                    <option value="9183-2797">9183-2797</option>
                    <option value="9823-3446">9823-3446</option>
                    <option value="0711-8310">0711-8310</option>
                    <option value="2676-9943">2676-9943</option>
                    <option value="4670-9305">4670-9305</option>
                    <option value="9213-3048">9213-3048</option>
                    <option value="4438-5982">4438-5982</option>
                    <option value="7135-8934">7135-8934</option>
                    <option value="9228-1494">9228-1494</option>
                    <option value="6748-5231">6748-5231</option>
                    <option value="1159-4178">1159-4178</option>
                    <option value="5655-4571">5655-4571</option>
                    <option value="3887-0449">3887-0449</option>
                    <option value="4221-3437">4221-3437</option>
                    <option value="3623-4177">3623-4177</option>
                    <option value="0701-7229">0701-7229</option>
                </select>
            `;
            const signatureCell = row.insertCell();
            signatureCell.innerHTML = `<button type="button" class="sign-btn">Sign</button>`;
            signatureCell.querySelector('.sign-btn').addEventListener('click', () => {
                currentSignatureCell = signatureCell;
                modalCanvas = document.getElementById('modalCanvas');
                modalCtx = modalCanvas.getContext('2d');
                modalCtx.strokeStyle = '#0000ff';
                modalCtx.lineWidth = 3;
                modalCtx.lineCap = 'round';
                modalCtx.clearRect(0, 0, modalCanvas.width, modalCanvas.height);
                modal.style.display = 'flex';
            });
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = 'Remove';
            removeBtn.onclick = () => row.remove();
            signatureCell.appendChild(removeBtn);
        });
        // Add Student Outside Dept.
        document.getElementById('add-student-outside').addEventListener('click', () => {
            const tbody = document.getElementById('students-outside-table').querySelector('tbody');
            const row = tbody.insertRow();
            row.insertCell().innerHTML = `<input type="text" name="student-outside-name" placeholder="Enter Name">`;
            row.insertCell().innerHTML = `<input type="text" name="student-outside-rank" placeholder="Enter Rank">`;
            row.insertCell().innerHTML = `<input type="text" name="student-outside-gfstc" maxlength="9" placeholder="Enter GFSTC #">`;
            const signatureCell = row.insertCell();
            signatureCell.innerHTML = `<button type="button" class="sign-btn">Sign</button>`;
            signatureCell.querySelector('.sign-btn').addEventListener('click', () => {
                currentSignatureCell = signatureCell;
                modalCanvas = document.getElementById('modalCanvas');
                modalCtx = modalCanvas.getContext('2d');
                modalCtx.strokeStyle = '#0000ff';
                modalCtx.lineWidth = 3;
                modalCtx.lineCap = 'round';
                modalCtx.clearRect(0, 0, modalCanvas.width, modalCanvas.height);
                modal.style.display = 'flex';
            });
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = 'Remove';
            removeBtn.onclick = () => row.remove();
            signatureCell.appendChild(removeBtn);
        });
        // Add Grading Point
        document.getElementById('add-grading-point').addEventListener('click', () => {
            const tbody = document.getElementById('grading-points-table').querySelector('tbody');
            const row = tbody.insertRow();
            row.insertCell().innerHTML = `
                <select name="grading-point">
                    <option value="">-- Select Grading Point --</option>
                    <option value="Street Familiarization">Street Familiarization</option>
                    <option value="Acceleration">Acceleration</option>
                    <option value="Speed Consistency">Speed Consistency</option>
                    <option value="Braking">Braking</option>
                    <option value="Downgrade Braking">Downgrade Braking</option>
                    <option value="Left Turns">Left Turns</option>
                    <option value="Right Turns">Right Turns</option>
                    <option value="Intersections">Intersections</option>
                    <option value="Lane Changing">Lane Changing</option>
                    <option value="Low Clearance">Low Clearance</option>
                    <option value="Use of Lighting (Non-Emergent)">Use of Lighting (Non-Emergent)</option>
                    <option value="Use of Lighting (Emergent)">Use of Lighting (Emergent)</option>
                    <option value="Cone Course">Cone Course</option>
                    <option value="Pump Operations Training">Pump Operations Training</option>
                    <option value="Aerial Operations Training">Aerial Operations Training</option>
                </select>
            `;
            row.insertCell().innerHTML = `
                <select name="grading-proficiency">
                    <option value="">-- Select --</option>
                    <option value="Meets the Standard">Meets the Standard</option>
                    <option value="Exceeds the Standard">Exceeds the Standard</option>
                    <option value="Needs Improvement">Needs Improvement</option>
                    <option value="Unsatisfactory">Unsatisfactory</option>
                </select>
            `;
            const commentCell = row.insertCell();
            commentCell.innerHTML = `
                <textarea name="grading-comments"></textarea>
                <button type="button" class="remove-grading-btn" onclick="this.closest('tr').remove()">Remove</button>
            `;
        });
        // Add Equipment
        let equipmentRowCount = 0;
        document.getElementById('add-equipment').addEventListener('click', () => {
            const tbody = document.getElementById('facility-equipment-table').querySelector('tbody');
            const row = tbody.insertRow();
            equipmentRowCount++;
            row.insertCell().innerHTML = `
                <select name="equipment-used">
                    <option value="">-- Select Equipment --</option>
                    <option value="Apparatus">Apparatus</option>
                    <option value="Suppression Equipment">Suppression Equipment</option>
                    <option value="PPE">PPE</option>
                    <option value="EMS Equipment">EMS Equipment</option>
                    <option value="Office Equipment">Office Equipment</option>
                    <option value="Training Facility Equipment">Training Facility Equipment</option>
                    <option value="Equipment from another organization">Equipment from another organization</option>
                </select>
            `;
            const damagedCell = row.insertCell();
            damagedCell.innerHTML = `
                <div class="damaged-buttons">
                    <button type="button" class="damaged-btn damaged-yes" data-row="${equipmentRowCount}" onclick="selectDamaged(this, 'Yes')">Yes</button>
                    <button type="button" class="damaged-btn damaged-no" data-row="${equipmentRowCount}" onclick="selectDamaged(this, 'No')">No</button>
                </div>
                <input type="hidden" name="damaged-${equipmentRowCount}" id="damaged-input-${equipmentRowCount}">
            `;
            const commentCell = row.insertCell();
            commentCell.innerHTML = `
                <textarea name="equipment-comments"></textarea>
                <button type="button" class="remove-equipment-btn" onclick="this.closest('tr').remove()">Remove</button>
            `;
        });
        function selectDamaged(button, value) {
            const row = button.getAttribute('data-row');
            const yesBtn = document.querySelector(`.damaged-yes[data-row="${row}"]`);
            const noBtn = document.querySelector(`.damaged-no[data-row="${row}"]`);
            const input = document.getElementById(`damaged-input-${row}`);
            yesBtn.classList.remove('selected');
            noBtn.classList.remove('selected');
            if (value === 'Yes') {
                yesBtn.classList.add('selected');
            } else {
                noBtn.classList.add('selected');
            }
            input.value = value;
        }
        let drawing = false;
        const startDrawing = (e) => {
            drawing = true;
            const rect = modalCanvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            modalCtx.beginPath();
            modalCtx.moveTo(x, y);
        };
        const draw = (e) => {
            if (!drawing) return;
            e.preventDefault();
            const rect = modalCanvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            modalCtx.lineTo(x, y);
            modalCtx.stroke();
        };
        const stopDrawing = () => {
            drawing = false;
        };
        document.getElementById('modalCanvas').addEventListener('mousedown', startDrawing);
        document.getElementById('modalCanvas').addEventListener('mousemove', draw);
        document.getElementById('modalCanvas').addEventListener('mouseup', stopDrawing);
        document.getElementById('modalCanvas').addEventListener('mouseout', stopDrawing);
        document.getElementById('modalCanvas').addEventListener('touchstart', startDrawing);
        document.getElementById('modalCanvas').addEventListener('touchmove', draw);
        document.getElementById('modalCanvas').addEventListener('touchend', stopDrawing);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
        document.getElementById('trainingForm').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('Training Report Submitted!');
        });
/* ---------- MOBILE & TABLET OPTIMIZATION ---------- */

/* Prevent iOS zoom on inputs */
input, select, textarea, button {
    font-size: 16px;
}

/* Tables scroll instead of crushing */
.table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

/* Larger touch targets */
.shift-btn,
.damaged-btn,
.sign-btn,
.copy-btn,
.remove-btn {
    min-height: 44px;
}

/* Signature modal responsive */
.modal-content {
    width: 95%;
}

.modal-canvas {
    width: 100%;
    height: auto;
}

/* Buttons spacing on mobile */
@media (max-width: 768px) {
    .buttons-row {
        gap: 12px;
    }

    .submit-btn,
    .print-btn {
        font-size: 1.2rem;
        padding: 16px;
    }

    header img {
        width: 100px;
    }

    .header-text h1 {
        font-size: 1.9rem;
    }

    .header-text p {
        font-size: 1.1rem;
    }
}

/* Tablet optimization */
@media (min-width: 769px) and (max-width: 1024px) {
    .container {
        padding: 30px;
    }

    .table th,
    .table td {
        font-size: 0.9rem;
    }
}

    </script>
</body>
</html>