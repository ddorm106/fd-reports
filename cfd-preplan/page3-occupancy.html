<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Fire Plan: Occupancy</title>
    <link rel="stylesheet" href="styles-preplan.css">
</head>
<body>
    <div class="page-wrapper">
        <div class="container">
            <header class="report-header">
                <div class="header-top">
                    <img src="images/cfd-logo.png" alt="Centerville Fire Department Logo" class="patch-logo">
                    <div class="header-text">
                        <h1>Centerville Fire Department</h1>
                        <h2>Pre-Fire Plan Data Sheet</h2>
                    </div>
                </div>
            </header>

            <div class="progress-indicator">Page 3 of 12: Occupancy</div>
            
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: 25%"></div>
            </div>

            <h3 class="section-title">3. Occupancy & Life Safety Information</h3>

            <form id="occupancy-form">
                <!-- Occupancy Types -->
                <div class="preplan-section">
                    <label class="inline-label">Primary Occupancy Types (select all that apply):</label>
                    <div class="apparatus-buttons occupancy-buttons">
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Assembly"><span>Assembly</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Educational"><span>Educational</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Health Care"><span>Health Care</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Detention/Correction"><span>Detention/Correction</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Residential"><span>Residential</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Mercantile"><span>Mercantile</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Storage"><span>Storage</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Daycare"><span>Daycare</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Business"><span>Business</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Industrial"><span>Industrial</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="occupancy_types" value="Mixed"><span>Mixed Occupancies</span></label>
                    </div>
                </div>

                <!-- Hazard of Contents -->
                <div class="preplan-section">
                    <label class="inline-label">Hazard of Contents:</label>
                    <div class="apparatus-buttons">
                        <label class="apparatus-btn"><input type="radio" name="hazard_contents" value="Low"><span>Low Hazard</span></label>
                        <label class="apparatus-btn"><input type="radio" name="hazard_contents" value="Ordinary"><span>Ordinary Hazard</span></label>
                        <label class="apparatus-btn"><input type="radio" name="hazard_contents" value="High"><span>High Hazard</span></label>
                    </div>
                </div>

                <!-- High Fire Load -->
                <div class="preplan-section">
                    <label class="inline-label">High Fire Load Areas Present?</label>
                    <div class="apparatus-buttons">
                        <label class="apparatus-btn"><input type="radio" name="high_fire_load" value="Yes"><span>Yes</span></label>
                        <label class="apparatus-btn"><input type="radio" name="high_fire_load" value="No"><span>No</span></label>
                    </div>
                    <div class="form-field evaluator-note" style="margin-top: 16px;">
                        <label for="high_fire_load_locs">Locations / Description:</label>
                        <textarea id="high_fire_load_locs" name="high_fire_load_locs" rows="3" placeholder="e.g., warehouse storage, paint booth, server room"></textarea>
                    </div>
                </div>

                <!-- Life Safety Concerns -->
                <div class="preplan-section">
                    <div class="form-field">
                        <label class="inline-label">Life Safety Concerns / Special Features:</label>
                        <textarea id="life_safety_concerns" name="life_safety_concerns" rows="4" placeholder="e.g., large occupant load, locked exits, panic hardware issues, special needs populations"></textarea>
                    </div>
                </div>

                <!-- Evacuation Plan -->
                <div class="preplan-section">
                    <label class="inline-label">Approved Evacuation Assembly Plan?</label>
                    <div class="apparatus-buttons">
                        <label class="apparatus-btn"><input type="radio" name="evac_plan" value="Yes"><span>Yes</span></label>
                        <label class="apparatus-btn"><input type="radio" name="evac_plan" value="No"><span>No</span></label>
                    </div>
                    <div class="form-field evaluator-note" style="margin-top: 16px;">
                        <label for="assembly_point_locs">Assembly Point Locations:</label>
                        <textarea id="assembly_point_locs" name="assembly_point_locs" rows="3" placeholder="e.g., Parking lot A, field behind building"></textarea>
                    </div>
                </div>

                <!-- Occupant Load -->
                <div class="preplan-section">
                    <label class="inline-label">Typical Occupant Load:</label>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="occupant_load_day">Daytime (Peak):</label>
                            <input type="number" id="occupant_load_day" name="occupant_load_day" min="0" placeholder="e.g., 450">
                        </div>
                        <div class="form-field">
                            <label for="occupant_load_night">Nighttime:</label>
                            <input type="number" id="occupant_load_night" name="occupant_load_night" min="0" placeholder="e.g., 12">
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" id="prev-btn" class="btn-secondary">← Previous</button>
                    <button type="button" id="next-btn" class="btn-primary">Next → Construction</button>
                </div>
            </form>
        </div>

        <footer>
            <img src="images/city-logo.png" alt="City of Centerville Logo" class="city-logo">
            <p>© 2026 City of Centerville Fire Department</p>
        </footer>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script>
        const form = document.getElementById('occupancy-form');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function getSavedData() {
            return JSON.parse(localStorage.getItem('preFirePlan') || '{}');
        }

        function saveData() {
            const data = { ...getSavedData() };
            
            // Handle occupancy_types checkboxes (multiple selection)
            const occupancyCheckboxes = form.querySelectorAll('input[name="occupancy_types"]:checked');
            data.occupancy_types = Array.from(occupancyCheckboxes).map(cb => cb.value);
            
            // Handle other inputs
            form.querySelectorAll('input:not([name="occupancy_types"]), textarea').forEach(el => {
                if (el.type === 'radio') {
                    if (el.checked) data[el.name] = el.value;
                } else if (el.value) {
                    data[el.name] = el.value;
                }
            });
            
            localStorage.setItem('preFirePlan', JSON.stringify(data));
        }

        // Load saved data
        window.addEventListener('load', () => {
            const saved = getSavedData();
            
            // Load occupancy types (array)
            if (saved.occupancy_types && Array.isArray(saved.occupancy_types)) {
                document.querySelectorAll('input[name="occupancy_types"]').forEach(cb => {
                    if (saved.occupancy_types.includes(cb.value)) cb.checked = true;
                });
            }
            
            // Load other fields
            Object.keys(saved).forEach(key => {
                if (key === 'occupancy_types') return;
                
                const elements = form.elements[key];
                if (!elements) return;
                
                if (elements.length) {
                    elements.forEach(el => {
                        if (el.type === 'radio' && saved[key] === el.value) {
                            el.checked = true;
                        }
                    });
                } else {
                    elements.value = saved[key] || '';
                }
            });
        });

        // Auto-save
        form.addEventListener('input', () => saveData());
        form.addEventListener('change', () => saveData());

        function navigate(url) {
            saveData();
            window.location.href = url;
        }

        prevBtn.addEventListener('click', () => navigate('page2-operating.html'));
        
        nextBtn.addEventListener('click', () => {
            if (form.checkValidity()) {
                saveData();
                showToast('Data saved', 'success');
                setTimeout(() => navigate('page4-construction.html'), 500);
            } else {
                form.reportValidity();
            }
        });
    </script>
</body>
</html>
