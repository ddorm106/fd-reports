<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pre-Fire Plan: Review & Submit</title>
<link rel="stylesheet" href="styles-preplan.css">
</head>
<body>
<div class="page-wrapper">
    <div class="container">
        <header class="report-header">
            <div class="header-top">
                <img src="images/cfd-logo.png" alt="Centerville Fire Department" class="patch-logo">
                <div class="header-text"><h1>Centerville Fire Department</h1><h2>Pre-Fire Plan Data Sheet</h2></div>
            </div>
        </header>
        <div class="progress-indicator">Page 12 of 12: Review & Submit</div>
        <div class="progress-bar-container"><div class="progress-bar" style="width:100%"></div></div>

        <h3 class="section-title">12. Review & Submit</h3>
        <div class="info-tip">Review all information below. Click any section header to go back and edit. When ready, submit or export your pre-plan.</div>
        <div id="reviewContent"></div>

        <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:24px 0">
            <button class="btn-primary" onclick="submitPlan()" style="font-size:1.1rem;padding:12px 32px">üì§ Submit Pre-Plan</button>
            <button class="btn-secondary" onclick="exportJSON()">üíæ Export JSON</button>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn-secondary" onclick="window.location.href='page11-floor-plan.html'">‚Üê Previous</button>
            <a href="preplan-index.html" class="btn-primary">Back to Overview</a>
        </div>
    </div>
</div>
<footer>
    <img src="images/city-logo.png" alt="City of Centerville" class="city-logo">
    <p>¬© 2026 City of Centerville Fire Department</p>
</footer>
<div class="toast-container" id="toast-container"></div>
<script src="preplan-common.js"></script>
<script>
var sections=[
    {title:'1. Location Information',page:'page1-location.html',fields:[
        {k:'pfp_number',l:'Plan #'},{k:'business_name',l:'Business Name'},{k:'address',l:'Address'},{k:'telephone_no',l:'Phone'},
        {k:'tax_id',l:'Tax ID'},{k:'fire_district',l:'Fire District'},{k:'latitude',l:'Latitude'},{k:'longitude',l:'Longitude'},{k:'general_directions',l:'Directions'}]},
    {title:'2. Operating Information',page:'page2-operating.html',fields:[
        {k:'primary_contact',l:'Primary Contact'},{k:'primary_tel',l:'Primary Phone'},{k:'secondary_contact',l:'Secondary Contact'},{k:'secondary_tel',l:'Secondary Phone'},
        {k:'operating_hours',l:'Operating Hours'},{k:'primary_access',l:'Primary Access'},{k:'exterior_access',l:'Exterior Concerns'},{k:'aerial_obstructions',l:'Aerial Obstructions'}]},
    {title:'3. Occupancy & Life Safety',page:'page3-occupancy.html',fields:[
        {k:'occupancy_types',l:'Occupancy Types'},{k:'hazard_contents',l:'Hazardous Contents'},{k:'high_fire_load',l:'High Fire Load'},{k:'life_safety_concerns',l:'Life Safety'},
        {k:'evac_plan',l:'Evac Plan'},{k:'occupant_load_day',l:'Occ Load (Day)'},{k:'occupant_load_night',l:'Occ Load (Night)'}]},
    {title:'4. Construction',page:'page4-construction.html',fields:[
        {k:'construction_type',l:'Construction Type'},{k:'length',l:'Length'},{k:'width',l:'Width'},{k:'height',l:'Height'},
        {k:'total_sq_ft',l:'Total Sq Ft'},{k:'num_stories',l:'Stories'},{k:'roof_construction',l:'Roof'},{k:'floor_construction',l:'Floor'},{k:'wall_construction',l:'Walls'},{k:'roof_trusses',l:'Trusses'}]},
    {title:'5. Fire Protection',page:'page5-fire-protection.html',fields:[
        {k:'sprinklered',l:'Sprinklered'},{k:'sprinkler_type',l:'Sprinkler Type'},{k:'fdc_loc',l:'FDC Location'},{k:'standpipe',l:'Standpipe'},
        {k:'fire_pumps',l:'Fire Pump'},{k:'fire_alarm',l:'Fire Alarm'},{k:'panel_loc',l:'FACP Location'},{k:'knox_box',l:'Knox Box'}]},
    {title:'6. Utilities',page:'page6-utilities.html',fields:[
        {k:'natural_gas',l:'Natural Gas'},{k:'natural_gas_loc',l:'Gas Location'},{k:'lp_gas',l:'LP Gas'},{k:'electric',l:'Electric'},
        {k:'electric_loc',l:'Electric Location'},{k:'emergency_power',l:'Emergency Power'},{k:'solar_power',l:'Solar'}]},
    {title:'7. Special Rescue',page:'page7-special-rescue.html',fields:[
        {k:'confined_space',l:'Confined Space'},{k:'high_angle',l:'High Angle'},{k:'water_rescue',l:'Water Rescue'},
        {k:'nfpa_health',l:'NFPA Health'},{k:'nfpa_fire',l:'NFPA Fire'},{k:'nfpa_reactivity',l:'NFPA Reactivity'},{k:'nfpa_special',l:'NFPA Special'},
        {k:'pre_plan_conducted_by',l:'Conducted By'},{k:'date',l:'Date'}]},
    {title:'8. Fire Flow',page:'page8-fire-flow.html',fields:[
        {k:'effective_area',l:'Effective Area'},{k:'calculated_nff',l:'NFF (GPM)'},{k:'available_supply',l:'Available Supply'}]},
    {title:'9. Hazardous Materials',page:'page9-hazardous-materials.html',fields:[
        {k:'tier_ii',l:'Tier II'},{k:'msds_onsite',l:'MSDS On-Site'},{k:'hazmat_notes',l:'Hazmat Notes'}]}
];
function render(){
    var data=getSavedData(),html='';
    sections.forEach(function(s){
        html+='<div class="review-section"><h4 style="cursor:pointer" onclick="window.location.href=\''+s.page+'\'">'+s.title+' ‚úèÔ∏è</h4><div class="review-grid">';
        s.fields.forEach(function(f){
            var v=data[f.k]||'';
            html+='<div class="review-item"><div class="review-label">'+f.l+'</div><div class="review-value'+(v?'':' empty')+'">'+(v||'Not provided')+'</div></div>';
        });
        html+='</div></div>';
    });
    document.getElementById('reviewContent').innerHTML=html;
}
function submitPlan(){
    var data=getSavedData();
    if(!data.business_name){showToast('Please fill in the business name first','error');return}
    fetch('/api/save-draft',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({data:data})})
    .then(function(r){return r.json()})
    .then(function(d){if(d.code)showToast('Submitted! Code: '+d.code,'success');else showToast('Saved!','success')})
    .catch(function(){showToast('Saved locally. Could not reach server.','info')});
}
function exportJSON(){
    var data=getSavedData();
    var name=(data.business_name||'preplan').replace(/[^a-zA-Z0-9]/g,'-').toLowerCase();
    var blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    var a=document.createElement('a');a.download=name+'-preplan-'+new Date().toISOString().slice(0,10)+'.json';
    a.href=URL.createObjectURL(blob);a.click();
    showToast('JSON exported','success');
}
render();
</script>
</body>
</html>
