<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Fire Plan: Hazardous Materials Data</title>
    <link rel="stylesheet" href="styles-preplan.css">
    <style>
        .add-row-btn {
            background: var(--navy-blue);
            color: white;
            border: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            margin-bottom: var(--spacing-md);
        }
        .add-row-btn:hover {
            background: var(--navy-dark);
        }
        .remove-row-btn {
            background: var(--fire-red);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
        }
        .remove-row-btn:hover {
            background: var(--fire-red-dark);
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="container">
            <header class="report-header">
                <div class="header-top">
                    <img src="images/cfd-logo.png" alt="Centerville Fire Department Logo" class="patch-logo">
                    <div class="header-text">
                        <h1>Centerville Fire Department</h1>
                        <h2>Pre-Fire Plan Data Sheet</h2>
                    </div>
                </div>
            </header>

            <div class="progress-indicator">Page 9 of 12: Hazardous Materials Data</div>
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: 75%"></div>
            </div>

            <h3 class="section-title">9. Hazardous Materials Data</h3>

            <form id="hazardous-materials-form">
                <!-- Chemical Inventory Table -->
                <div class="preplan-section">
                    <label class="inline-label">Chemical Inventory:</label>
                    <button type="button" id="add-chem-row-btn" class="add-row-btn">+ Add Chemical</button>
                    
                    <div style="overflow-x: auto;">
                        <table id="chem-table">
                            <thead>
                                <tr>
                                    <th>Chemical Name</th>
                                    <th>UN/ID #</th>
                                    <th>Quantity</th>
                                    <th>Location</th>
                                    <th>Hazard Class</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="chem-table-body">
                                <tr data-row="1">
                                    <td><input type="text" name="chem_name_1" placeholder="e.g., Sulfuric Acid"></td>
                                    <td><input type="text" name="chem_id_1" placeholder="e.g., UN1830"></td>
                                    <td><input type="text" name="chem_qty_1" placeholder="e.g., 500 gal"></td>
                                    <td><input type="text" name="chem_loc_1" placeholder="e.g., Storage room B"></td>
                                    <td><input type="text" name="chem_class_1" placeholder="e.g., Corrosive"></td>
                                    <td><button type="button" class="remove-row-btn" onclick="removeRow(this)">✕</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Chemical Inventory Status -->
                <div class="preplan-section">
                    <label class="inline-label">Up to Date Chemical Inventory List Available:</label>
                    <div class="apparatus-buttons">
                        <label class="apparatus-btn"><input type="radio" name="chem_inventory" value="Yes"><span>Yes</span></label>
                        <label class="apparatus-btn"><input type="radio" name="chem_inventory" value="No"><span>No</span></label>
                    </div>
                    
                    <label class="inline-label" style="margin-top: var(--spacing-md);">Chemical Inventory List Provided to Fire Dept:</label>
                    <div class="apparatus-buttons">
                        <label class="apparatus-btn"><input type="radio" name="chem_list_provided" value="Yes"><span>Yes</span></label>
                        <label class="apparatus-btn"><input type="radio" name="chem_list_provided" value="No"><span>No</span></label>
                    </div>
                </div>

                <!-- Tier II Information -->
                <div class="preplan-section">
                    <label class="inline-label">Tier II Reporting Facility (EPCRA Section 312):</label>
                    <div class="apparatus-buttons">
                        <label class="apparatus-btn"><input type="radio" name="tier_ii" value="Yes"><span>Yes</span></label>
                        <label class="apparatus-btn"><input type="radio" name="tier_ii" value="No"><span>No</span></label>
                    </div>
                    
                    <label class="inline-label" style="margin-top: var(--spacing-md);">SDS/MSDS Received with Tier II Form:</label>
                    <div class="apparatus-buttons">
                        <label class="apparatus-btn"><input type="radio" name="msds_received" value="Yes"><span>Yes</span></label>
                        <label class="apparatus-btn"><input type="radio" name="msds_received" value="No"><span>No</span></label>
                    </div>
                </div>

                <!-- SDS Location -->
                <div class="preplan-section">
                    <label class="inline-label">SDS/MSDS Binder Location On-Site:</label>
                    <div class="apparatus-buttons">
                        <label class="apparatus-btn"><input type="radio" name="msds_onsite" value="Yes"><span>Yes</span></label>
                        <label class="apparatus-btn"><input type="radio" name="msds_onsite" value="No"><span>No</span></label>
                    </div>
                    <div class="form-field" style="margin-top: var(--spacing-md);">
                        <label for="msds_location">Specific Location:</label>
                        <input type="text" id="msds_location" name="msds_location" placeholder="e.g., Front office, maintenance room">
                    </div>
                </div>

                <!-- Special Hazards -->
                <div class="preplan-section">
                    <label class="inline-label">Special Hazardous Materials Concerns:</label>
                    <div class="apparatus-buttons" style="flex-wrap: wrap;">
                        <label class="apparatus-btn"><input type="checkbox" name="haz_flammable" value="Yes"><span>Flammable Liquids/Gases</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="haz_oxidizer" value="Yes"><span>Oxidizers</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="haz_corrosive" value="Yes"><span>Corrosives</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="haz_toxic" value="Yes"><span>Toxic Materials</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="haz_reactive" value="Yes"><span>Water Reactive</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="haz_radioactive" value="Yes"><span>Radioactive</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="haz_compressed" value="Yes"><span>Compressed Gases</span></label>
                        <label class="apparatus-btn"><input type="checkbox" name="haz_cryogenic" value="Yes"><span>Cryogenics</span></label>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="preplan-section">
                    <div class="form-field">
                        <label for="additional_info">Additional Hazmat Information / Special Considerations:</label>
                        <textarea id="additional_info" name="additional_info" rows="4" placeholder="Describe any special hazmat considerations, incompatible materials, special extinguishing requirements, etc."></textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" id="prev-btn" class="btn-secondary">← Previous</button>
                    <button type="button" id="next-btn" class="btn-primary">Next → Site Plan</button>
                </div>
            </form>
        </div>

        <footer>
            <img src="images/city-logo.png" alt="City of Centerville Logo" class="city-logo">
            <p>© 2026 City of Centerville Fire Department</p>
        </footer>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script>
        const form = document.getElementById('hazardous-materials-form');
        const tableBody = document.getElementById('chem-table-body');
        const addRowBtn = document.getElementById('add-chem-row-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        let rowCount = 1;

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        function addRow() {
            rowCount++;
            const row = document.createElement('tr');
            row.dataset.row = rowCount;
            row.innerHTML = `
                <td><input type="text" name="chem_name_${rowCount}" placeholder="Chemical name"></td>
                <td><input type="text" name="chem_id_${rowCount}" placeholder="UN#"></td>
                <td><input type="text" name="chem_qty_${rowCount}" placeholder="Quantity"></td>
                <td><input type="text" name="chem_loc_${rowCount}" placeholder="Location"></td>
                <td><input type="text" name="chem_class_${rowCount}" placeholder="Hazard class"></td>
                <td><button type="button" class="remove-row-btn" onclick="removeRow(this)">✕</button></td>
            `;
            tableBody.appendChild(row);
        }

        function removeRow(btn) {
            const row = btn.closest('tr');
            if (tableBody.children.length > 1) {
                row.remove();
            } else {
                showToast('Cannot remove last row', 'error');
            }
        }

        addRowBtn.addEventListener('click', addRow);

        function getSavedData() {
            return JSON.parse(localStorage.getItem('preFirePlan') || '{}');
        }

        function saveData() {
            const data = { ...getSavedData() };
            
            // Clear old chemical data
            Object.keys(data).forEach(key => {
                if (key.startsWith('chem_')) {
                    delete data[key];
                }
            });
            
            form.querySelectorAll('input, textarea').forEach(el => {
                if (el.type === 'radio') {
                    if (el.checked) data[el.name] = el.value;
                } else if (el.type === 'checkbox') {
                    data[el.name] = el.checked ? el.value : '';
                } else if (el.value) {
                    data[el.name] = el.value;
                }
            });
            localStorage.setItem('preFirePlan', JSON.stringify(data));
        }

        window.addEventListener('load', () => {
            const saved = getSavedData();
            
            // Determine max row count
            let maxRow = 1;
            Object.keys(saved).forEach(key => {
                const match = key.match(/chem_\w+_(\d+)/);
                if (match) {
                    maxRow = Math.max(maxRow, parseInt(match[1]));
                }
            });
            
            // Add necessary rows
            for (let i = 2; i <= maxRow; i++) {
                addRow();
            }
            
            // Load values
            Object.keys(saved).forEach(key => {
                const el = form.elements[key];
                if (!el) return;
                if (el.length) {
                    el.forEach(e => {
                        if (e.type === 'radio' && saved[key] === e.value) e.checked = true;
                        if (e.type === 'checkbox' && saved[key] === e.value) e.checked = true;
                    });
                } else if (el.type === 'checkbox') {
                    el.checked = saved[key] === el.value;
                } else {
                    el.value = saved[key] || '';
                }
            });
        });

        form.addEventListener('input', () => saveData());
        form.addEventListener('change', () => saveData());

        function navigate(url) { saveData(); window.location.href = url; }

        prevBtn.addEventListener('click', () => navigate('page8-fire-flow.html'));
        nextBtn.addEventListener('click', () => {
            if (form.checkValidity()) {
                saveData();
                showToast('Data saved', 'success');
                setTimeout(() => navigate('page10-site-plan.html'), 500);
            } else { form.reportValidity(); }
        });
    </script>
</body>
</html>
